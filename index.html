<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>재고 조회 시스템</title>
</head>
<body>
    <h1>재고 조회 시스템</h1>
    <label for="brand">브랜드 선택:</label>
    <select id="brand" onchange="filterModelsByBrand()">
        <option value="">브랜드를 선택하세요</option>
    </select>
    
    <label for="model">모델명 선택:</label>
    <select id="model" onchange="filterColorsByModel()">
        <option value="">모델을 선택하세요</option>
    </select>
    
    <label for="color">색상 선택:</label>
    <select id="color">
        <option value="">색상을 선택하세요</option>
    </select>
    
    <button onclick="searchInventory()">조회</button>

    <div id="result"></div>

    <script>
        async function fetchAndPopulateDropdowns() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSwLT86v-lHw4J_yX_mCnQq8RP2SMkr_yz-qwD4nM3WxF6f-DKx6TTdtCW_eZv_Tg/pub?output=csv');
                if (!response.ok) throw new Error('네트워크 응답이 정상이 아닙니다.');
                const dataText = await response.text();
                const data = parseCSV(dataText);
                window.inventoryData = data;
                populateBrands(data);
            } catch (error) {
                console.error('데이터를 가져오는 중 오류가 발생했습니다:', error);
            }
        }

        function parseCSV(dataText) {
            const rows = dataText.split("\n");
            const headers = rows[0].split(",");
            return rows.slice(1).map(row => {
                const values = row.split(",");
                let result = {};
                headers.forEach((header, index) => {
                    if (header && values[index]) {
                        result[header.trim()] = values[index].trim();
                    }
                });
                return result;
            });
        }

        function populateBrands(data) {
            const brandDropdown = document.getElementById('brand');
            const brands = new Set(data.map(item => item['브랜드']));
            brands.forEach(brand => {
                if (brand) {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    brandDropdown.appendChild(option);
                }
            });
        }

        function filterModelsByBrand() {
            const brand = document.getElementById('brand').value;
            const modelDropdown = document.getElementById('model');
            modelDropdown.innerHTML = '<option value="">모델을 선택하세요</option>';

            if (brand && window.inventoryData) {
                const models = new Set(window.inventoryData
                    .filter(item => item['브랜드'] === brand)
                    .map(item => item['모델명']));
                models.forEach(model => {
                    if (model) {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        modelDropdown.appendChild(option);
                    }
                });
            }
        }

        function filterColorsByModel() {
            const brand = document.getElementById('brand').value;
            const model = document.getElementById('model').value;
            const colorDropdown = document.getElementById('color');
            colorDropdown.innerHTML = '<option value="">색상을 선택하세요</option>';

            if (brand && model && window.inventoryData) {
                const colors = new Set(window.inventoryData
                    .filter(item => item['브랜드'] === brand && item['모델명'] === model)
                    .map(item => item['색상']));
                colors.forEach(color => {
                    if (color) {
                        const option = document.createElement('option');
                        option.value = color;
                        option.textContent = color;
                        colorDropdown.appendChild(option);
                    }
                });
            }
        }

        function searchInventory() {
            const brand = document.getElementById('brand').value;
            const model = document.getElementById('model').value;
            const color = document.getElementById('color').value;
            const resultElement = document.getElementById('result');
            resultElement.textContent = '';

            if (brand && model && color && window.inventoryData) {
                const filteredData = window.inventoryData.filter(item =>
                    item['브랜드'] === brand &&
                    item['모델명'] === model &&
                    item['색상'] === color
                );
                if (filteredData.length > 0) {
                    let resultText = '조회 결과:\n';
                    filteredData.forEach(item => {
                        resultText += `모델명: ${item['모델명']}, 색상: ${item['색상']}, 보유처: ${item['보유처']}, 지역: ${item['지역']}\n`;
                    });
                    resultElement.textContent = resultText;
                } else {
                    resultElement.textContent = '해당 조건에 맞는 재고가 없습니다.';
                }
            } else {
                resultElement.textContent = '모든 조건을 선택해주세요.';
            }
        }

        window.onload = function() {
            fetchAndPopulateDropdowns();
        };
    </script>
</body>
</html>
